{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Tsuru","text":""},{"location":"admin/local_environment/helm/","title":"Installing Tsuru in a local Kubernetes cluster with Helm","text":"<p>All steps in this guide were done in Kubernetes v1.20.0. While it might work for almost all Kubernetes versions, some versions may break something. Feel free to report us in that case.</p>"},{"location":"admin/local_environment/helm/#prerequisites","title":"Prerequisites","text":"<ol> <li>Minikube</li> <li>kubectl</li> <li>Helm</li> </ol>"},{"location":"admin/local_environment/helm/#jumpstarting-the-cluster","title":"Jumpstarting the cluster","text":"<p>Tsuru has a Makefile recipe (<code>make local</code>) to locally run a minikube cluster on your machine, but feel free to bootstrap your minikube cluster anyway you want.</p>"},{"location":"admin/local_environment/helm/#hardware-requirements","title":"Hardware Requirements","text":"<ul> <li>2 CPUs or more</li> <li>12GB of free memory</li> <li>20GB of free disk space</li> </ul>"},{"location":"admin/local_environment/helm/#installing-the-helm-chart","title":"Installing the helm chart","text":"<ul> <li> <p>Adding tsuru's helm chart</p> <ul> <li><code>helm repo add tsuru https://tsuru.github.io/charts</code> </li> </ul> </li> <li> <p>Installing the chart</p> <ul> <li><code>helm install tsuru tsuru/tsuru-stack --create-namespace --namespace tsuru-system</code></li> </ul> </li> </ul> <p>Congratulations you have tsuru installed and runnning on your cluster!</p>"},{"location":"admin/local_environment/helm/#admin-configuration","title":"Admin Configuration","text":"<ol> <li> <p>Create the admin user on tsuru:</p> <p><code>kubectl exec -it -n tsuru-system deploy/tsuru-api -- tsurud root user create admin@admin.com</code></p> <p>You can replace <code>admin@admin.com</code> with any email you'd prefer</p> </li> <li> <p>Use Port-forward to access tsuru and ingress controller locally:</p> <p><code>kubectl port-forward --namespace tsuru-system svc/tsuru-api 8080:80 &amp; kubectl port-forward --namespace tsuru-system svc/tsuru-ingress-nginx-controller 8890:80 &amp;</code></p> <p>If you specified a port when you installed helm it will have to use the same port in tsuru-ingress-nginx-controller.</p> </li> <li> <p>Add the localhost to tsuru target and log in:</p> <p><code>tsuru target-add default https://localhost:8080 -s</code></p> <p><code>tsuru login</code></p> </li> <li> <p>Create a team:</p> <p><code>tsuru team create admin</code></p> </li> <li> <p>Add at least one platform:</p> <p><code>tsuru platform add go</code></p> <p>This is just an example, you could add python or other platforms i.e:</p> <p><code>tsuru platform add python</code></p> </li> </ol>"},{"location":"admin/local_environment/helm/#optional-steps","title":"Optional Steps","text":"<ul> <li> <p>Create and Deploy tsuru-dashboard app:</p> <p><code>tsuru app create dashboard</code></p> <p><code>tsuru app deploy -a dashboard --image tsuru/dashboard</code></p> </li> <li> <p>Create an app to test:</p> <p><code>mkdir example-go</code></p> <p><code>cd example-go</code></p> <p><code>git clone https://github.com/tsuru/platforms.git</code></p> <p><code>cd platforms/examples/go</code></p> <p><code>tsuru app create example-go go</code></p> <p><code>tsuru app deploy -a example-go</code></p> </li> </ul>"},{"location":"admin/local_environment/make-local/","title":"Installing Tsuru locally","text":"<p>This guide will walk you through running the tsuru api locally and attaching it to your running kubernetes cluster</p>"},{"location":"admin/local_environment/make-local/#prerequisites","title":"Prerequisites","text":"<ol> <li>Minikube (this can be optional if you already have a cluster running)</li> <li>kubectl</li> </ol>"},{"location":"admin/local_environment/make-local/#git-clone","title":"Git clone","text":"<p>First things thirst, please clone tsuru repository and cd into it:</p> <p><code>git clone https://github.com/tsuru/tsuru.git &amp; cd tsuru</code></p>"},{"location":"admin/local_environment/make-local/#jumpstarting-the-cluster-optional","title":"Jumpstarting the cluster (optional)","text":"<p>Tsuru has a Makefile recipe <code>make local</code> to locally run a minikube cluster on your machine, but feel free to bootstrap your cluster anyway you want.</p> <p>It's important to make sure the tsuru api has access to the services running inside the cluster and can talk to the Kubernetes api, this can be easily achieved by running the cluster using the none driver when running minikube</p> <p>If you just want to test things out locally we highly recommend the usage of <code>make local</code> for simplicity and support</p>"},{"location":"admin/local_environment/make-local/#run-the-tsuru-api","title":"Run the tsuru api","text":"<ul> <li> <p>If you've ran the <code>make local</code> recipe and got no errors the api should already be up and running.</p> <p>If you decide to create the cluster on your behalf, you still have to build and run the api, there's also a recipe for that: <code>make local-api</code></p> </li> </ul>"},{"location":"admin/local_environment/make-local/#admin-configuration","title":"Admin Configuration","text":"<ul> <li> <p>Edit the host paramater inside etc/tsuru-local.conf and replace it with your own local IP</p> <p>To find out your local IP either run <code>ifconfig</code> or the newer <code>ip --addr</code> command</p> </li> <li> <p>Create the admin user on tsuru:</p> <p><code>tsurud root user create admin@admin.com</code></p> <p>You can replace <code>admin@admin.com</code> with any email you'd prefer</p> </li> <li> <p>Add the localhost to tsuru target and log in using your credentials created in step 1:</p> <p><code>tsuru target-add default https://localhost:8080 -s</code></p> <p><code>tsuru login</code></p> </li> <li> <p>Create a team:</p> <p><code>tsuru team create admin-team</code></p> </li> <li> <p>Create a pool:</p> <p><code>tsuru pool create kubepool --provisioner=kubernetes --default=true</code></p> </li> <li> <p>Add your running cluster to tsuru:</p> <p><code>tsuru cluster add minikube kubernetes --addr https://`minikube ip`:8443 --cacert $HOME/.minikube/ca.crt --clientcert $HOME/.minikube/profiles/minikube/apiserver.crt --clientkey $HOME/.minikube/profiles/minikube/apiserver.key --pool kubepool</code></p> </li> <li> <p>Check your node IP:</p> <p><code>tsuru node list -f tsuru.io/cluster=minikube</code></p> </li> <li> <p>Register your node IP as a member of kubepool:</p> <p><code>tsuru node update &lt;node ip&gt; pool=kubepool</code></p> </li> </ul>"},{"location":"admin/local_environment/make-local/#optional-steps","title":"Optional Steps","text":"<ul> <li> <p>Add a platform:</p> <p><code>tsuru platform add go</code></p> </li> <li> <p>Create and Deploy tsuru-dashboard app:</p> <p><code>tsuru app create dashboard</code></p> <p><code>tsuru app deploy -a dashboard --image tsuru/dashboard</code></p> </li> <li> <p>Create an app to test:</p> <p><code>mkdir example-go</code></p> <p><code>cd example-go</code></p> <p><code>git clone https://github.com/tsuru/platforms.git</code></p> <p><code>cd platforms/examples/go</code></p> <p><code>tsuru app create example-go go</code></p> <p><code>tsuru app deploy -a example-go</code></p> </li> </ul>"},{"location":"references/tsuru.yaml/","title":"Tsuru YAML","text":"<p>Voc\u00ea pode configurar </p> <p>Tsuru permite que sua app </p> <p>How can I submit <code>tsuru.yaml</code>?</p> <p>dfoooooooo</p>"},{"location":"user_guides/deploy_using_dockerfile/","title":"Deploy using Dockerfile","text":"<p>Tsuru official's platforms don't support every language, framework, or runtime your tech stack may require. It doesn't intend to do so. If you have a setup where the official platforms don't meet your needs, you can deploy your app using its Dockerfile (Containerfile).</p> <p>Comparison: container image x Dockerfile</p> <p>Developer's convenience is the key difference between deploying an app using a container image and Dockerfile. The former requires extra steps on the developer's side, such as building and publishing the container image, the latter doesn't.</p> <p>This guide will walk you through the steps to deploy into an app using a simple Dockerfile.</p>"},{"location":"user_guides/deploy_using_dockerfile/#prerequisites","title":"Prerequisites","text":"<p>This guide assumes that you have:</p> <ol> <li>Tsuru client installed (version must be &gt;= 1.15);</li> <li>Set a Tsuru target (server version must be &gt;= 1.14);</li> <li>Logged into Tsuru;</li> <li>An app (henceforth referred as <code>hello-world-app</code>) where your user has permission to deploy on.</li> </ol>"},{"location":"user_guides/deploy_using_dockerfile/#usage","title":"Usage","text":"<p>In this example, we are building and deploying a simple application written in Go. You can checkout the complete code used here on samples/dockerfile_v1. You might take a closer look at <code>Dockerfile</code> and <code>main.go</code> files, but there's no mytery on them.</p> <p>To deploy into application using its Dockerfile, you just need issue the below command:</p> <pre><code>tsuru app deploy -a hello-world --dockerfile ./\n</code></pre> <p>The main difference among other types of deploys on Tsuru is the new command argument <code>--dockerfile</code>. The <code>--dockerfile</code> command argument allows you to pass a directory or a specific container file.</p> <ol> <li> <p>When you pass a directory, Tsuru client tries to find the container file following these names (order matters):</p> <ul> <li><code>Dockerfile.&lt;app name&gt;</code> (e.g. <code>Dockerfile.hello-world-app</code>)</li> <li><code>Containerfile.&lt;app name&gt;</code> (e.g. <code>Containerfile.hello-world-app</code>)</li> <li><code>Dockerfile.tsuru</code></li> <li><code>Containerfile.tsuru</code></li> <li><code>Dockerfile</code></li> <li><code>Containerfile</code></li> </ul> <p>Example: <pre><code>tsuru app deploy -a &lt;app name&gt; --dockerfile ./path/to/dir/\n</code></pre></p> </li> <li> <p>When you pass a regular file, Tsuru consider it as the container file - regardless of its file name.</p> <p>Example: <pre><code>tsuru app deploy -a &lt;app name&gt; --dockerfile ./path/to/Dockerfile.custom\n</code></pre></p> </li> </ol> <p>In both cases, the build context (files passed to the builder where you can refer on COPY/ADD directives) is the current working directory. Otherwise, you can select only the files you want by passing their namely.</p> <p>Example: <pre><code>tsuru app deploy -a &lt;app name&gt; --dockerfile ./path/to/Dockerfile file1.txt file2.txt\n</code></pre></p>"},{"location":"user_guides/deploy_using_dockerfile/#advanced-tweaks","title":"Advanced tweaks","text":""},{"location":"user_guides/deploy_using_dockerfile/#how-can-i-access-tsuru-env-vars-during-container-image-build","title":"How can I access Tsuru env vars during container image build?","text":"<p>You're able to import the env vars configured on Tsuru app while running the deploy with Dockerfile. To do so, you just need append the following snippet in the Dockerfile.</p> <pre><code>RUN --mount=type=secret,id=tsuru-app-envvars,target=/var/run/secrets/envs.sh \\\n&amp;&amp; . /var/run/secrets/envs.sh \\\n... following commands in this multi-command line are able to see the env vars from Tsuru\n</code></pre> <p>NOTE: That's a bit different than defining <code>ENV</code> directive, specially because they're not stored in the image layers.</p>"},{"location":"user_guides/deploy_using_dockerfile/#limitations","title":"Limitations","text":"<ol> <li>You cannot use distroless based images on your final container image - although on intermediary stages is fine.1</li> <li>There's no support for setting build arguments.</li> <li>There's no support to specify a particular platform - the only platform supported is <code>linux/amd64</code>.</li> </ol> <ol> <li> <p>Tsuru requires a shell intepreter (e.g. <code>sh</code> or <code>bash</code>) to run hooks, app shell, etc.\u00a0\u21a9</p> </li> </ol>"}]}