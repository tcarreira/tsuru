

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building your service &mdash; tsuru 1.6.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TSURU_SERVICES environment variable" href="tsuru-services-env-var.html" />
    <link rel="prev" title="API workflow" href="api.html" /> 

<link rel="stylesheet" href="_static/css/theme_overrides.css" type="text/css" />



  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> tsuru
          

          
          </a>

          
            
            
              <div class="version">
                1.6.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../understanding/index.html">Understanding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing/index.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managing/index.html">Managing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/index.html">Using</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Services</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api.html">API workflow</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Building your service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-your-service-api">Creating your service API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authentication">Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listing-available-plans">Listing available plans</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-new-instances">Creating new instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="#updating-service-instances">Updating service instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="#binding-instances-to-apps">Binding instances to apps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unbinding-instances-from-apps">Unbinding instances from apps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#whitelisting-units">Whitelisting units</a></li>
<li class="toctree-l4"><a class="reference internal" href="#removing-instances">Removing instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="#checking-the-status-of-an-instance">Checking the status of an instance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-service-manifest">Creating a service manifest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#submiting-your-service-api">Submiting your service API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tsuru-services-env-var.html">TSURU_SERVICES environment variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="open-service-broker.html">Open Service Broker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_topics/index.html">Advanced topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../experimental/index.html">Experimental</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tsuru</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Services</a> &raquo;</li>
        
      <li>Building your service</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/services/build.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-your-service">
<h1>Building your service<a class="headerlink" href="#building-your-service" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This document is a hands-on guide to turning your existing cloud service into a
tsuru service.</p>
<p>In order to create a service you need to implement a provisioning API for your
service, which tsuru will call using <a class="reference external" href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods">HTTP protocol</a>
when a customer creates a new instance or binds a service instance with an app.</p>
<p>You will also need to create a YAML document that will serve as the service
manifest. We provide a command-line tool to help you to create this manifest
and manage your service.</p>
</div>
<div class="section" id="creating-your-service-api">
<h2>Creating your service API<a class="headerlink" href="#creating-your-service-api" title="Permalink to this headline">¶</a></h2>
<p>To create your service API, you can use any programming language or framework.
In this tutorial we will use <a class="reference external" href="http://flask.pocoo.org">Flask</a>.</p>
</div>
<div class="section" id="authentication">
<h2>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<p>tsuru uses basic authentication for authenticating the services, for more
details, check the <a class="reference internal" href="api.html#service-api-flow-authentication"><span class="std std-ref">service API workflow</span></a>.</p>
<p>Using Flask, you can manage basic authentication using a decorator described in
this Flask snippet: <a class="reference external" href="http://flask.pocoo.org/snippets/8/">http://flask.pocoo.org/snippets/8/</a>.</p>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>First, let’s ensure that Python and pip are already installed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python --version
Python <span class="m">2</span>.7.2

$ pip
Usage: pip COMMAND <span class="o">[</span>OPTIONS<span class="o">]</span>

pip: error: You must give a <span class="nb">command</span> <span class="o">(</span>use <span class="s2">&quot;pip help&quot;</span> to see a list of commands<span class="o">)</span>
</pre></div>
</div>
<p>For more information about how to install python you can see the <a class="reference external" href="http://python.org/download/">Python
download documentation</a> and about how to install
pip you can see the <a class="reference external" href="http://www.pip-installer.org/en/latest/installing.html">pip installation instructions</a>.</p>
<p>Now, with python and pip installed, you can use pip to install Flask:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install flask
</pre></div>
</div>
<p>Now that Flask is installed, it’s time to create a file called api.py and add
the code needed to create a minimal Flask application:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Hello World!&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>For run this app you can do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python api.py
 * Running on http://127.0.0.1:5000/
</pre></div>
</div>
<p>If you open your web browser and access the url <a class="reference external" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a> you will
see the message “Hello World!”.</p>
<p>Then, you need to implement the resources of a tsuru service API, as described
in the <a class="reference internal" href="api.html"><span class="doc">tsuru service API workflow</span></a>.</p>
</div>
<div class="section" id="listing-available-plans">
<h3>Listing available plans<a class="headerlink" href="#listing-available-plans" title="Permalink to this headline">¶</a></h3>
<p>tsuru will get the list of available plans by issuing a GET request in the
<code class="docutils literal notranslate"><span class="pre">/resources/plans</span></code> URL. Let’s create the view that will handle this kind
of request:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/plans&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">plans</span><span class="p">():</span>
    <span class="n">plans</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;small&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;small instance&quot;</span><span class="p">},</span>
             <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;medium instance&quot;</span><span class="p">},</span>
             <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;big&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;big instance&quot;</span><span class="p">},</span>
             <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;giant&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;giant instance&quot;</span><span class="p">}]</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">plans</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-new-instances">
<h3>Creating new instances<a class="headerlink" href="#creating-new-instances" title="Permalink to this headline">¶</a></h3>
<p>For new instances tsuru sends a POST to /resources with the parameters needed
for creating an instance. If the service instance is successfully created, your
API should return 201 in status code.</p>
<p>Let’s create the view for this action:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add_instance</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plan&quot;</span><span class="p">)</span>
    <span class="n">team</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
    <span class="c1"># use the given parameters to create the instance</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">201</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-service-instances">
<h3>Updating service instances<a class="headerlink" href="#updating-service-instances" title="Permalink to this headline">¶</a></h3>
<p>When a service instance is updated, tsuru sends a PUT to /resources with the updated
parameters for the instance. If the service instance is successfully updated, your
API should return 200 in status code.</p>
<p>This endpoint is optional. That means you could leave it unimplemented and return a
404 status code, and tsuru would simply ignore it.</p>
<p>Here’s an example implementation for this endpoint:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add_instance</span><span class="p">():</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PUT&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">update_instance</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">)</span>
    <span class="n">team</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plan&quot;</span><span class="p">)</span>
    <span class="c1"># use the given parameters to update the instance &quot;name&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">200</span>
</pre></div>
</div>
</div>
<div class="section" id="binding-instances-to-apps">
<h3>Binding instances to apps<a class="headerlink" href="#binding-instances-to-apps" title="Permalink to this headline">¶</a></h3>
<p>In the bind action, tsuru calls your service via POST on
<code class="docutils literal notranslate"><span class="pre">/resources/&lt;service-instance-name&gt;/bind-app</span></code> with the parameters needed for
binding an app into a service instance.</p>
<p>If the bind operation succeeds, the API should return 201 as status code with
the variables to be exported in the app environment on body in JSON format.</p>
<p>As an example, let’s create a view that returns a json with a fake variable
called “SOMEVAR” to be injected in the app environment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;/bind-app&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">bind_app</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">app_host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app-host&quot;</span><span class="p">)</span>
    <span class="c1"># use name and app_host to bind the service instance and the #</span>
    <span class="n">application</span>
    <span class="n">envs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;SOMEVAR&quot;</span><span class="p">:</span> <span class="s2">&quot;somevalue&quot;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">envs</span><span class="p">),</span> <span class="mi">201</span>
</pre></div>
</div>
</div>
<div class="section" id="unbinding-instances-from-apps">
<h3>Unbinding instances from apps<a class="headerlink" href="#unbinding-instances-from-apps" title="Permalink to this headline">¶</a></h3>
<p>In the unbind action, tsuru issues a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> request to the URL
<code class="docutils literal notranslate"><span class="pre">/resources/&lt;service-instance-name&gt;/bind-app</span></code>.</p>
<p>If the unbind operation succeeds, the API should return 200 as status code.
Let’s create the view for this action:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;/bind-app&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DELETE&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">unbind_app</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">app_host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app-host&quot;</span><span class="p">)</span>
    <span class="c1"># use name and app-host to remove the bind</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">200</span>
</pre></div>
</div>
</div>
<div class="section" id="whitelisting-units">
<h3>Whitelisting units<a class="headerlink" href="#whitelisting-units" title="Permalink to this headline">¶</a></h3>
<p>When binding and unbindin application and service instances, tsuru will also
provide information about units that will have access to the service instance,
so the service API can handle any required whitelisting (writing ACL rules to a
network switch or authorizing access in a firewall, for example).</p>
<p>tsuru will send POST and DELETE requests to the route
<code class="docutils literal notranslate"><span class="pre">/resources/&lt;name&gt;/bind</span></code>, with the host of the app and the unit, so any
access control can be handled by the API:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;/bind&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">access_control</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">app_host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app-host&quot;</span><span class="p">)</span>
    <span class="n">unit_host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit-host&quot;</span><span class="p">)</span>
    <span class="c1"># use unit-host and app-host, according to the access control tool, and</span>
    <span class="c1"># the request method.</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">201</span>
</pre></div>
</div>
</div>
<div class="section" id="removing-instances">
<h3>Removing instances<a class="headerlink" href="#removing-instances" title="Permalink to this headline">¶</a></h3>
<p>In the remove action, tsuru issues a DELETE request to the URL
<code class="docutils literal notranslate"><span class="pre">/resources/&lt;service_name&gt;</span></code>.</p>
<p>If the service instance is successfully removed, the API should return 200 as
status code.</p>
<p>Let’s create a view for this action:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DELETE&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">remove_instance</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c1"># remove the instance named &quot;name&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">200</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-the-status-of-an-instance">
<h3>Checking the status of an instance<a class="headerlink" href="#checking-the-status-of-an-instance" title="Permalink to this headline">¶</a></h3>
<p>To check the status of an instance, tsuru issues a GET request to the URL
<code class="docutils literal notranslate"><span class="pre">/resources/&lt;service_name&gt;/status</span></code>. If the instance is ok, this URL should
return 204.</p>
<p>Let’s create a view for this action:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;/status&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c1"># check the status of the instance named &quot;name&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">204</span>
</pre></div>
</div>
<p>The final code for our “fake API” developed in Flask is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/plans&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">plans</span><span class="p">():</span>
    <span class="n">plans</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;small&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;small instance&quot;</span><span class="p">},</span>
             <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;medium instance&quot;</span><span class="p">},</span>
             <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;big&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;big instance&quot;</span><span class="p">},</span>
             <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;giant&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;giant instance&quot;</span><span class="p">}]</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">plans</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add_instance</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plan&quot;</span><span class="p">)</span>
    <span class="n">team</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
    <span class="c1"># use the given parameters to create the instance</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">201</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;/bind-app&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">bind_app</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">app_host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app-host&quot;</span><span class="p">)</span>
    <span class="c1"># use name and app_host to bind the service instance and the #</span>
    <span class="n">application</span>
    <span class="n">envs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;SOMEVAR&quot;</span><span class="p">:</span> <span class="s2">&quot;somevalue&quot;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">envs</span><span class="p">),</span> <span class="mi">201</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;/bind-app&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DELETE&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">unbind_app</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">app_host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app-host&quot;</span><span class="p">)</span>
    <span class="c1"># use name and app-host to remove the bind</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">200</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DELETE&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">remove_instance</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c1"># remove the instance named &quot;name&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">200</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;/bind&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">access_control</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">app_host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app-host&quot;</span><span class="p">)</span>
    <span class="n">unit_host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit-host&quot;</span><span class="p">)</span>
    <span class="c1"># use unit-host and app-host, according to the access control tool, and</span>
    <span class="c1"># the request method.</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">201</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/resources/&lt;name&gt;/status&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c1"># check the status of the instance named &quot;name&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">204</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-a-service-manifest">
<span id="id1"></span><h2>Creating a service manifest<a class="headerlink" href="#creating-a-service-manifest" title="Permalink to this headline">¶</a></h2>
<p>Using tsuru-client you can create a manifest template:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tsuru service-template
</pre></div>
</div>
<p>This will create a manifest.yaml in your current path with this content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">servicename</span>
<span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">abc123</span>
<span class="nt">endpoint</span><span class="p">:</span>
    <span class="nt">production</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">production-endpoint.com</span>
</pre></div>
</div>
<p>The manifest.yaml is used to defined the ID, the password and the
production endpoint of your service.</p>
<p>Change these information in the created manifest, and the <a class="reference internal" href="#submit-your-service">submit your
service</a>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">servicename</span>
<span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">username_to_auth</span>
<span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1CWpoX2Zr46Jhc7u</span>
<span class="nt">endpoint</span><span class="p">:</span>
  <span class="nt">production</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">production-endpoint.com</span>
    <span class="l l-Scalar l-Scalar-Plain">test</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">test-endpoint.com:8080</span>
</pre></div>
</div>
<p><span class="target" id="submit-your-service">submit your service</span>: <a class="reference internal" href="#submiting-your-service-api">Submiting your service API</a></p>
</div>
<div class="section" id="submiting-your-service-api">
<h2>Submiting your service API<a class="headerlink" href="#submiting-your-service-api" title="Permalink to this headline">¶</a></h2>
<p>To submit your service, you can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tsuru service-create manifest.yaml
</pre></div>
</div>
<p>For more details, check the <a class="reference internal" href="api.html"><span class="doc">service API workflow</span></a> and the
<a class="reference external" href="https://tsuru-client.readthedocs.io/en/latest/reference.html#service-management">tsuru-client service management reference</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tsuru-services-env-var.html" class="btn btn-neutral float-right" title="TSURU_SERVICES environment variable" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api.html" class="btn btn-neutral" title="API workflow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, tsuru authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Versions</span>
    v: 1.6.2
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dd><a href="/stable/">stable</a></dd>
      <dd><a href="/latest/">latest</a></dd>
      <dd><a href="/main/">main</a></dd>
    </dl>
    <dl>
      <dt>Releases</dt>
      <dd><a href="/1.12/">1.12</a></dd>
      <dd><a href="/1.11/">1.11</a></dd>
      <dd><a href="/1.10/">1.10</a></dd>
      <dd><a href="/1.9/">1.9</a></dd>
      <dd><a href="/1.8/">1.8</a></dd>
      <dd><a href="/1.7/">1.7</a></dd>
      <dd><a href="/1.6/">1.6</a></dd>
      <dd><a href="/1.5/">1.5</a></dd>
      <dd><a href="/1.4/">1.4</a></dd>
      <dd><a href="/1.3/">1.3</a></dd>
      <dd><a href="/1.2/">1.2</a></dd>
      <dd><a href="/1.1/">1.1</a></dd>
      <dd><a href="/1.0/">1.0</a></dd>
      <dd><a href="/0.13/">0.13</a></dd>
      <dd><a href="/0.12/">0.12</a></dd>
      <dd><a href="/0.11/">0.11</a></dd>
      <dd><a href="/0.10/">0.10</a></dd>
      <dd><a href="/0.9/">0.9</a></dd>
      <dd><a href="/0.8/">0.8</a></dd>
      <dd><a href="/0.7/">0.7</a></dd>
      <dd><a href="/0.6/">0.6</a></dd>
      <dd><a href="/0.5/">0.5</a></dd>
      <dd><a href="/0.4/">0.4</a></dd>
      <dd><a href="/0.3/">0.3</a></dd>
      <dd><a href="/0.2/">0.2</a></dd>
      <dd><a href="/0.1/">0.1</a></dd>
    </dl>
    <hr />
  </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.6.2',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>